

//function ????????????? RTC                                                                //
//argument none                                                                             //
//result   1 - ????????????? ?????????; 0 - ???? ??? ???? ????????????????                  //
//********************************************************************************************
unsigned char  RtcInit  (void)
{
 //????????? ???????????? ??????? ?????????? ???????? ? ??????????? ????????? ????????
  RCC->APB1ENR |= RCC_APB1ENR_PWREN | RCC_APB1ENR_BKPEN;
  //????????? ?????? ? ??????? ????????? ??????
  PWR->CR |= PWR_CR_DBP;
  //???? ???? ????????? - ???????????????? ??
  if ((RCC->BDCR & RCC_BDCR_RTCEN) != RCC_BDCR_RTCEN)
  {
    //????????? ????? ??????? ????????? ??????
    RCC->BDCR |=  RCC_BDCR_BDRST;
    RCC->BDCR &= ~RCC_BDCR_BDRST;
 
    //??????? ?????????? ???????? ????????? ??????? ????? 32768 ? ?????? ????????????
    RCC->BDCR |=  RCC_BDCR_RTCEN | RCC_BDCR_RTCSEL_LSE;
 
    RTC->CRL  |=  RTC_CRL_CNF;
    RTC->PRLL  = 0x7FFF;         //??????? ??????? ?? 32768
    RTC->CRL  &=  ~RTC_CRL_CNF;
 
    //?????????? ??? ?????????? ?????? ? ????????? ????????? ???? ??????????
    RCC->BDCR |= RCC_BDCR_LSEON;
    while ((RCC->BDCR & RCC_BDCR_LSEON) != RCC_BDCR_LSEON){}
 
    RTC->CRL &= (uint16_t)~RTC_CRL_RSF;
    while((RTC->CRL & RTC_CRL_RSF) != RTC_CRL_RSF){}
 
    return 1;
  }
  return 0;
}

// про сохранение костант



адрес коробки
номер версии по
номер версии прибора
серийный номер

усреднение дл€ ацп
настройка времени дл€ определени€ максимума

группа калибровок 1
    калибр таблица 1
    калибр таблица 2
    
группа калибровок 2
    калибр таблица 1
    калибр таблица 2
номер группы текущей таблицы
реверс выбора группы и передачи


пороги реле, таймауты реле

настройка индикаторов
настройка 
 

AN2594 EEPROM emulation.
AN3969


заработала передача
когда из шлейфа 9 ножку посадил на PD3 который ==1
т.е. по схеме mod-rs485 DE=1
но при этом ~RE присоединенный на PD4, котора€=0 не работает, а когда он висит в воздухе то работает!!

странна как та..
кварц внутренный при этом спешит так же на 3 сек в минуту

оказываетс€ прием так же работает!!!

протокол выбираем слудующий (кажда€ цифра кодируетс€ аски):
: ADR LEN kom n1 n2 n3 n4 n5 .. (enter)

1. установить врем€
: 01 10 vrem yy mm dd hh mm ss (enter)

2. записать калибровку первой передачи

3. записать калибровку второй передачи

4. установить адрес

5. установить порог

6. установить врем€ дл€ накоплени€ максимума

7. рестарт

8. активный режим
: 01 10 aktiv on enter
3a30313130

9. тихий режим
: 01 10 silens enter
3a30313130

10. прочитать калибровку первой передачи

11. прочитать калибровку второй передачи

12. прочитать адрес

13. прочитать врем€

14. прочитать значение и врем€
: 1 10 read enter

15. прочитать порог

16. прочитать врем€ дл€ накоплени€ максимума

17. прочитать всю конфигу
: 1 10 rd_conf enter

18. записать всю конфигу
: 1 10 wr_conf 1 2 3 4 5 6 7 8 9 .. enter


типы раюоты порта
GPIO_Mode_AIN                Ч аналоговый вход;
GPIO_Mode_IN_FLOATING  Ч цифровой  вход, третье состо€ние;
GPIO_Mode_IPD                Ч цифровой вход, подт€жка к земле;
GPIO_Mode_IPU                Ч цифровой вход, подт€жка к плюсу питани€;
GPIO_Mode_Out_OD          Ч выход общего назначени€, открытый сток;
GPIO_Mode_Out_PP           Ч симметричный выход общего назначени€;
GPIO_Mode_AF_OD           -  выход альтернативной ф-ии, открытый сток;
GPIO_Mode_AF_PP            -  симметричный выход альтернативной ф-ии 